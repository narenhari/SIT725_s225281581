<%- include('../components/header', { title: typeof title !=='undefined' ? title : 'Profile' , isProfileSection: true })
    %>

    <main>
        <div class="dash-shell">
            <div class="profile-layout">
                <%- include('../components/profileSidebar', { activeSection: typeof activeSection !=='undefined' ?
                    activeSection : 'profile' }) %>
                    <div class="profile-main">
                        <div class="card-head">
                            <h3>Profile</h3>
                        </div>
                        <div class="btn-card">
                            <p class="grey-text text-darken-2">
                            <div class="btn-card-hello">
                                Welcome, <%= (typeof user !=='undefined' && user && user.name) ? user.name : 'User' %>
                            </div><br>
                            <%= user.email %>
                                </p>
                        </div>

                        <!-- Showcase Message History in Profile Page -->
                        <br>
                        <hr><br>
                        <div class="">
                            <div class="card-head">
                                <br>
                                <h3>Announcement History</h3>
                            </div>

                            <!-- Delete Announcement History -->
                            <div class="row valign-wrapper" style="margin-bottom: 20px; margin-top: 40px;">

                                <div class="col s12 m3">
                                    <label>
                                        <input type="checkbox" id="select-all-page" />
                                        <span class="black-text" style="font-size: 1rem;">Select All on Page</span>
                                    </label>
                                </div>

                                <div class="col s12 m6">
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        <input type="date" id="delete-start-date" class="browser-default"
                                            style="border: 1px solid #ccc; padding: 5px; border-radius: 4px; height: 36px; flex: 1;">

                                        <span style="font-weight: bold; color: #9e9e9e;">to</span>

                                        <input type="date" id="delete-end-date" class="browser-default"
                                            style="border: 1px solid #ccc; padding: 5px; border-radius: 4px; height: 36px; flex: 1;">
                                    </div>
                                </div>

                                <div class="col s12 m2 offset-m1 right-align">
                                    <button id="btn-bulk-delete" class="btn red waves-effect waves-light z-depth-0"
                                        style="width: 100%;">
                                        <i class="material-icons left">delete</i>Delete
                                    </button>
                                </div>
                            </div>

                            <div class="btn-card">
                                <div id="message-history">
                                    <% if (typeof announcements !=='undefined' && announcements.length> 0) { %>

                                        <% announcements.forEach(function(msg) { %>

                                            <% var borderColor=(msg.type==='system' ) ? '#f44336' : '#2196F3' ; %>
                                                <% var iconColor=(msg.type==='system' ) ? 'red-text' : 'blue-text' ; %>
                                                    <% var iconName=(msg.type==='system' ) ? 'warning' : 'info' ; %>

                                                        <div class="card-panel grey lighten-5 z-depth-1"
                                                            style="padding: 15px; margin-bottom: 10px; border-left: 5px solid;">
                                                            <div class="row valign-wrapper" style="margin-bottom: 0;">

                                                                <div class="col s2 m1">
                                                                    <i class="material-icons circle <%= iconColor %>">
                                                                        <%= iconName %>
                                                                    </i>
                                                                </div>

                                                                <div class="col s10 m11">
                                                                    <span class="black-text">
                                                                        <%= msg.content %>
                                                                    </span>
                                                                    <br>
                                                                    <small class="grey-text">
                                                                        <%= new Date(msg.createdAt).toLocaleDateString()
                                                                            %> â€¢ <%= new
                                                                                Date(msg.createdAt).toLocaleTimeString()
                                                                                %>
                                                                    </small>
                                                                </div>
                                                            </div>
                                                        </div>

                                                        <% }); %>

                                                            <% } else { %>
                                                                <div class="center-align grey-text"
                                                                    style="padding: 20px;">
                                                                    <p>No new announcements.</p>
                                                                </div>
                                                                <% } %>

                                </div>
                                <div class="pagination-controls center-align" style="margin-top: 20px;">
                                    <button id="prev-page" class="btn-flat waves-effect" disabled>
                                        <i class="material-icons left">chevron_left</i>
                                    </button>
                                    <span id="page-info" style="margin: 0 15px; font-weight: bold;">Page 1</span>
                                    <button id="next-page" class="btn-flat waves-effect">
                                        <i class="material-icons right">chevron_right</i>
                                    </button>
                                </div>
                            </div>


                            <!----------------------------->
                            <br>
                            <hr><br>
                            <div class="btn-card">
                                <div class="btn-card-header"> Generate Data </div>
                                <p> DEMO: Generate 60 random sleep entries and one goal entry of various days and hours.
                                </p>
                                <button id="gen-data" class="btn">Generate Data</button>
                                <%- include('../components/gen-data') %>
                            </div>


                            <!-- Export Sleep Entries Data to CSV -->
                            <br>
                            <div class="btn-card">
                                <div class="btn-card-header"> Export </div>
                                <p> Export sleep entries into CSV format</p>
                                <a href="/api/sleep-entries/export" class="btn black main-action-btn z-depth-0">
                                    Export Sleep Data
                                </a>
                            </div>

                            <!-- User Account Deletion Button  -->
                            <br>
                            <div class="warn-btn-card">
                                <div class="btn-card-header"> Delete Personal Account </div>
                                <p>User account and all stored data are permanently deleted. An email confirmation
                                    is required before completion of aciton. Please ensure caution is applied if wishing
                                    to proceed.</p>
                                <%- include('../components/confirmUserDelete') %>
                            </div>

                            <!----------------------------->

                        </div>
                    </div>
            </div>

            <!--Pop-up model for message deleteion confirmation-->
            <div id="modal-bulk-delete" class="modal">
                <div class="modal-content">
                    <h4>Confirm Deletion</h4>
                    <p id="bulk-delete-msg">Are you sure you want to delete these messages?</p>
                </div>
                <div class="modal-footer">
                    <a href="#!" class="modal-close waves-effect waves-green btn-flat">Cancel</a>
                    <button id="btn-confirm-modal" class="waves-effect waves-light btn red">Delete</button>
                </div>
            </div>

            <script src="/js/profile-page.js"></script>
    </main>

    <%- include('../components/footer') %>