<style>
.popup {
    display: none;
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0, 0, 0, 0.5);
    justify-content: center;
    align-items: center;
}
.popup-content {
    background: #fff;
    padding: 20px;
    border-radius: 5px;
    text-align: center;
}
</style>

<a id="openPopup" class="btn pull-btn red"> 
    Delete Account
</a>

<div id="popup" class="popup">
    <div class="popup-content">
        <h3>Delete your account?</h3>
        <p>Are you sure you want to permanently delete your account?<br>
            This action will delete all user data.
        </p>

        <p style="margin-top: 10px;">Type your Email to confirm:</p>
        <input 
            type="text" 
            id="confirmInput" 
            placeholder="Enter your email"
            style="padding: 5px; width: 80%; margin-bottom: 15px;"
            autocomplete="off"
        >

        <button id="closePopup" class="btn" style="margin: 0px 100px 0 0;">
            Close
        </button>


        <button 
            id="delete" 
            class="btn red"
            style="opacity: 0.5; pointer-events: auto;">
            Delete
        </button>
   </div>
</div>

<script>
    const openPopup = document.getElementById('openPopup');
    const closePopup = document.getElementById('closePopup');
    const popup = document.getElementById('popup');

    const confirmInput = document.getElementById('confirmInput');
    const deleteBtn = document.getElementById('delete');

    const email = "<%=user.email%>";


    openPopup.addEventListener('click', () => {
        popup.style.display = 'flex';
    });

    closePopup.addEventListener('click', () => {
        popup.style.display = 'none';
    });

    window.addEventListener('click', (event) => {
        if (event.target === popup) {
            popup.style.display = 'none';
        }
    });


    confirmInput.addEventListener('input', () => {
        if (confirmInput.value.trim() === email) {
            deleteBtn.style.opacity = "1";
            deleteBtn.style.pointerEvents = "auto";
        } else {
            deleteBtn.style.opacity = "0.5";
            deleteBtn.style.pointerEvents = "none";
        }
    });
    
    deleteBtn.addEventListener("click", async () => {
        try {
            fetch("/api/delete-user", {
                method: "DELETE",
                credentials: "include",
            });
            window.location.href = "/auth/logout";
        } catch (err) {
            console.error(err);
            console.log("Network error while deleting account");
        }
    });

</script>

